(this["webpackJsonplogseq-plugin-markdown-table"]=this["webpackJsonplogseq-plugin-markdown-table"]||[]).push([[0],{205:function(e,t,n){},260:function(e,t,n){},261:function(e,t,n){"use strict";n.r(t);n(99);var r=n(0),o=n.n(r),c=n(18),i=n.n(c),a=(n(125),n(126),n(52)),l=n(15),s=n(11),u=n(2),d=n(270),b=n(1),f=n(31),h=function(e){var t=e.deleteBackward,n=e.deleteForward,r=e.insertBreak;return e.deleteBackward=function(n){var r=e.selection;if(r){var o=b.a.nodes(e,{match:function(e){return!b.a.isEditor(e)&&b.b.isElement(e)&&"table-cell"===e.type}}),c=Object(u.a)(o,1)[0],i=b.a.before(e,r),a=b.a.nodes(e,{at:i,match:function(e){return!b.a.isEditor(e)&&b.b.isElement&&"table-cell"===e.type}}),l=Object(u.a)(a,1)[0];if(c){var s=Object(u.a)(c,2)[1],d=b.a.start(e,s);if(b.e.equals(r.anchor,d))return}if(!c&&l)return}t(n)},e.deleteForward=function(t){var r=e.selection;if(r&&b.f.isCollapsed(r)){var o=b.a.nodes(e,{match:function(e){return!b.a.isEditor(e)&&b.b.isElement(e)&&"table-cell"===e.type}}),c=Object(u.a)(o,1)[0],i=b.a.after(e,r),a=b.a.nodes(e,{at:i,match:function(e){return!b.a.isEditor(e)&&b.b.isElement&&"table-cell"===e.type}}),l=Object(u.a)(a,1)[0];if(c){var s=Object(u.a)(c,2)[1],d=b.a.end(e,s);if(b.e.equals(r.anchor,d))return}if(!c&&l)return}n(t)},e.insertBreak=function(){if(e.selection){var t=b.a.nodes(e,{match:function(e){return!b.a.isEditor(e)&&b.b.isElement(e)&&"table"===e.type}});if(Object(u.a)(t,1)[0])return}r()},e},j=(n(128),n(32)),m=n(264),p=n(265),v=n(266),O=n(267),w=n(268),y=n(269),x=n(14),g=n(41),E="|||\n|--|--|\n|||",k=/^\|.+\|$/,C=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=(e=e||E).trim().split("\n").filter(Boolean),n=[t[0]].concat(t.slice(2)),r=n.map((function(e){var t=e.trim().split("|");return t.slice(1,t.length-1)}));return N(r)},A=function(e){return{type:"table-cell",children:[{text:e}]}},N=function(e){var t=Array.from(e,(function(e){return function(e){return{type:"table-row",children:Array.from(e,(function(e){return A(e)}))}}(e)}));return{type:"table",children:t}},T=n(88),S=function e(t){var n=this;Object(g.a)(this,e),this.insertTable=function(e,t){var r=b.a.nodes(n.editor,{match:function(e){return!b.a.isEditor(e)&&b.b.isElement(e)&&"table"===e.type},mode:"highest"});if(!Object(u.a)(r,1)[0]&&e&&t){var o=Array.from({length:e},(function(){return Array.from({length:t},(function(){return""}))})),c=N(o);b.h.insertNodes(n.editor,c,{mode:"highest"}),b.h.insertNodes(n.editor,{type:"paragraph",children:[{text:""}]},{mode:"highest"})}},this.insertCells=function(e,t,r,o){var c,i=r.anchor,a={row:null===i||void 0===i?void 0:i.path[1],column:null===i||void 0===i?void 0:i.path[2]},l=Array.from(e.children,(function(e){return Array.from(e.children,(function(e){return e.children[0].text}))})),u=l[0].length,d=Object(s.a)({},r);if("insert-row-above"===o){l.splice(a.row,0,Array(u).fill(""));var f=Object(x.a)(i.path);f.splice(1,1,a.row+1),d={anchor:Object(s.a)(Object(s.a)({},d.anchor),{},{path:f}),focus:Object(s.a)(Object(s.a)({},d.focus),{},{path:f})}}else if("insert-row-below"===o)l.splice(a.row+1,0,Array(u).fill(""));else if("insert-column-above"===o){l=Array.from(l,(function(e){var t=Object(x.a)(e);return t.splice(a.column,0,""),t}));var h=Object(x.a)(i.path);h.splice(2,1,a.column+1),d={anchor:Object(s.a)(Object(s.a)({},d.anchor),{},{path:h}),focus:Object(s.a)(Object(s.a)({},d.focus),{},{path:h})}}else if("insert-column-below"===o)l=Array.from(l,(function(e){var t=Object(x.a)(e);return t.splice(a.column+1,0,""),t}));else if("delete-row"===o&&(null===(c=l)||void 0===c?void 0:c.length)>1)l.splice(a.row,1);else{if(!("delete-column"===o&&u>1))return console.error("[insert cells run error]: unsupport action or can not delete",o,u);l=Array.from(l,(function(e){var t=Object(x.a)(e);return t.splice(a.column,1),t}))}n.removeTable();var j=N(l);b.h.insertNodes(n.editor,j,{at:t}),"delete-row"!==o&&"delete-column"!==o&&b.h.select(n.editor,d)},this.removeTable=function(){b.h.removeNodes(n.editor,{match:function(e){return!b.a.isEditor(e)&&b.b.isElement(e)&&"table"===e.type},mode:"highest"})},this.edit=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"insert-row-below",t=n.editor.selection;if(t&&b.f.isCollapsed(t)){var r=b.a.nodes(n.editor,{match:function(e){return!b.a.isEditor(e)&&b.b.isElement(e)&&"table"===e.type}}),o=Object(u.a)(r,1),c=o[0];if(c){var i=Object(u.a)(c,2),a=i[0],l=i[1];/^cursor-\w+/.test(e)?n.moveCursor(a,t,e):n.insertCells(a,l,t,e)}}},this.moveCursor=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"cursor-next",o=t.focus,c={row:null===o||void 0===o?void 0:o.path[1],column:null===o||void 0===o?void 0:o.path[2]},i=e.children.length,a=e.children[0].children.length;function l(t,n){var r=Object(T.get)(e.children,n.slice(1,3).map((function(e){return"[".concat(e,"].children")})).concat("[".concat(n[3],"].text")).join("")),o={path:n,offset:r.length};b.h.select(t,{anchor:o,focus:o})}if("cursor-next"===r){var s=Object(x.a)(o.path);c.column<a-1?s=[0,c.row,c.column+1,0]:c.row<i-1&&(s=[0,c.row+1,0,0]),l(n.editor,s)}else if("cursor-prev"===r){var u=Object(x.a)(o.path);c.column>0?u=[0,c.row,c.column-1,0]:c.row>0&&(u=[0,c.row-1,a-1,0]),l(n.editor,u)}},this.editor=t},B=n(6),_=function(){var e=Object(f.d)(),t=new S(e),n=function(e,n){e.preventDefault(),t.edit(n)};return Object(B.jsxs)("div",{className:"mb-2 space-x-2 bg-white inline-flex px-3 py-1 rounded-md shadow-sm",children:[Object(B.jsx)(j.a,{title:"insert row above",arrowPointAtCenter:!0,placement:"topLeft",children:Object(B.jsx)(m.a,{className:"text-xl cursor-pointer hover:opacity-70",onMouseDown:function(e){return n(e,"insert-row-above")}})}),Object(B.jsx)(j.a,{title:"insert rowbelow",arrowPointAtCenter:!0,placement:"topLeft",children:Object(B.jsx)(p.a,{className:"text-xl cursor-pointer hover:opacity-70",onMouseDown:function(e){return n(e,"insert-row-below")}})}),Object(B.jsx)(j.a,{title:"delete row",arrowPointAtCenter:!0,placement:"topLeft",children:Object(B.jsx)(v.a,{className:"text-xl cursor-pointer hover:opacity-70",onMouseDown:function(e){return n(e,"delete-row")}})}),Object(B.jsx)("div",{className:"border-l border-gray-300"}),Object(B.jsx)(j.a,{title:"insert column above",arrowPointAtCenter:!0,placement:"topLeft",children:Object(B.jsx)(O.a,{className:"text-xl cursor-pointer hover:opacity-70",onMouseDown:function(e){return n(e,"insert-column-above")}})}),Object(B.jsx)(j.a,{title:"insert column below",arrowPointAtCenter:!0,placement:"topLeft",children:Object(B.jsx)(w.a,{className:"text-xl cursor-pointer hover:opacity-70",onMouseDown:function(e){return n(e,"insert-column-below")}})}),Object(B.jsx)(j.a,{title:"delete column",arrowPointAtCenter:!0,placement:"topLeft",children:Object(B.jsx)(y.a,{className:"text-xl cursor-pointer hover:opacity-70",onMouseDown:function(e){return n(e,"delete-column")}})})]})},D=function(e){var t=e.attributes,n=e.children;switch(e.element.type){case"table":return Object(B.jsx)("table",{children:Object(B.jsx)("tbody",Object(s.a)(Object(s.a)({},t),{},{children:n}))});case"table-row":return Object(B.jsx)("tr",Object(s.a)(Object(s.a)({},t),{},{children:n}));case"table-cell":return Object(B.jsx)("td",Object(s.a)(Object(s.a)({},t),{},{children:n}));default:return Object(B.jsx)("p",Object(s.a)(Object(s.a)({},t),{},{children:n}))}},M=function(e,t){var n=e.content,o=void 0===n?E:n,c=e.className,i=void 0===c?"":c,a=Object(r.useState)([C(o)]),l=Object(u.a)(a,2),d=l[0],j=l[1],m=Object(r.useMemo)((function(){return h(Object(f.e)(Object(b.i)()))}),[]),p=Object(r.useMemo)((function(){return new S(m)}),[m]),v=Object(r.useCallback)((function(e){return Object(B.jsx)(D,Object(s.a)({},e))}),[]);return Object(r.useImperativeHandle)(t,(function(){return{getEditorValue:function(){return d},onKeydown:function(e){f.b.isFocused(m)&&("Tab"===e?p.edit("cursor-next"):"ShiftTab"===e&&p.edit("cursor-prev"))}}}),[d,m,p]),Object(B.jsx)("div",{className:i,children:Object(B.jsxs)(f.c,{editor:m,value:d,onChange:j,children:[Object(B.jsx)(_,{}),Object(B.jsx)(f.a,{placeholder:"Write something",renderElement:v})]})})},P=Object(r.forwardRef)(M),I=(n(205),window.logseq),z=I.App,R=I.Editor,L="browser"===Object({NODE_ENV:"production",PUBLIC_URL:".",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_ENV,K=function(e,t,n){return e.slice(t,n).filter((function(e){return k.test(e)})).join("\n")},F=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=e.split("\n"),r=[];t.forEach((function(e,t,o){var c=Object(u.a)(e,2),i=c[0],a=c[1],l=0===t?0:o[t-1][1];i===l||r.push({str:n.slice(l,i).join("\n"),type:"notTable"}),r.push({str:K(n,i,a),type:"table"})}));var o=Object(u.a)(t[t.length-1],2),c=o[1];return n.length-1>=c&&r.push({str:n.slice(c).join("\n"),type:"notTable"}),r},H=function(e){var t=e.content,n=e.tables,o=e.blockId,c=Object(r.useRef)({}),i=Object(r.useState)([]),b=Object(u.a)(i,2),f=b[0],h=b[1],j=function(){return I.hideMainUI()},m=Object(r.useCallback)((function(e){"Tab"===e.code&&!1===e.shiftKey?(e.preventDefault(),Object.keys(c.current).forEach((function(e){var t,n;null===(t=c.current)||void 0===t||null===(n=t[e])||void 0===n||n.onKeydown("Tab")}))):"Tab"===e.code&&e.shiftKey&&(e.preventDefault(),Object.keys(c.current).forEach((function(e){var t,n;null===(t=c.current)||void 0===t||null===(n=t[e])||void 0===n||n.onKeydown("ShiftTab")})))}),[]);return Object(r.useEffect)((function(){var e=F(t,n);h(e),console.log("[faiz:] === arrAfterSplitByTable",e)}),[t,n]),Object(r.useEffect)((function(){return window.addEventListener("keydown",m),function(){window.removeEventListener("keydown",m)}}),[m]),Object(B.jsxs)("div",{className:"w-screen h-screen flex flex-col justify-center items-center",children:[Object(B.jsx)("div",{className:"w-screen h-screen absolute",style:{background:"rgba(0, 0, 0, .3)",zIndex:-1},onClick:j}),Object(B.jsx)("div",{className:"w-2/3 overflow-y-auto",style:{maxHeight:"80%"},children:Object(B.jsx)("div",{className:"mt-2 flex flex-col",children:null===f||void 0===f?void 0:f.map((function(e,t){return"table"===(null===e||void 0===e?void 0:e.type)?Object(B.jsx)(P,{className:"my-2",content:null===e||void 0===e?void 0:e.str,ref:function(e){return function(e,t){c.current=Object(s.a)(Object(s.a)({},c.current),{},Object(l.a)({},e,t))}(t,e)}},t):Object(B.jsx)("div",{className:"bg-gray-400 text-gray-300 my-3 rounded px-1 py-2",style:{whiteSpace:"pre-line"},children:e.str},t)}))})}),Object(B.jsx)(a.a,{ghost:!0,className:"rounded mt-2 flex items-center",icon:Object(B.jsx)(d.a,{}),onClick:function(){h((function(e){return e.find((function(e){return"table"===e.type}))?e.concat([{type:"notTable",str:""},{type:"table",str:E}]):e.concat({type:"table",str:E})}))},children:"Add New Table"}),Object(B.jsxs)("div",{className:"flex w-2/3 flex-row justify-end mt-4",children:[Object(B.jsx)(a.a,{className:"mr-1 rounded",onClick:j,children:"Cancel"}),Object(B.jsx)(a.a,{className:"rounded",type:"primary",onClick:function(){if(!o&&!L)return z.showMsg("uuid error");var e=f.map((function(e,t){if("table"===e.type){var n,r,o,i=null===(n=c.current)||void 0===n||null===(r=n[t])||void 0===r||null===(o=r.getEditorValue())||void 0===o?void 0:o[0];return console.log("[faiz:] === slateVal",i),function(e){var t=Array.from(e.children,(function(e){var t=Array.from(e.children,(function(e){return e.children[0].text})).join("|");return"|".concat(t,"|")}));return t.splice(1,0,"|".concat(Array.from(e.children[0].children,(function(){return"--"})).join("|"),"|")),t.join("\n")}(i)}return e.str})).join("\n");if(L)return console.log("[faiz:] === save content:\n",e,"\nblockId:",o);R.updateBlock(o,e).then((function(){z.showMsg("markdown table overwrite success"),I.hideMainUI()})).catch((function(e){z.showMsg("markdown table overwrite error","warning"),console.log("[faiz:] === onClickConfirm error",e)}))},children:"Confirm"})]})]})},q=n(97),U=new(n.n(q).a),V=function e(t){var n=t.split("\n"),r=U.parse(t,{}).filter((function(e){return"table_open"===(null===e||void 0===e?void 0:e.type)})).map((function(e){var t=Object(u.a)(e.map,2),r=t[0],o=t[1],c=n[o];if(k.test(c))return e.map;for(var i=-1;o>r;){if(k.test(n[o])){i=o;break}o--}return[r,i+1]}));return 0===(null===r||void 0===r?void 0:r.length)?(console.warn("[faiz:] === No Table Found"),e(t+="".concat(""===t?"":"\n").concat(E))):r},W=(n(260),window.logseq),J=W.Editor,$=W.App,G="browser"===Object({NODE_ENV:"production",PUBLIC_URL:".",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_ENV,Q=function(e,t){console.log("[faiz:] === Raw Input: \n",e);var n=V(e);console.log("[faiz:] === markdownIt parse res",n),function(e,t,n){i.a.render(Object(B.jsx)(o.a.StrictMode,{children:Object(B.jsx)(H,{content:e,tables:t,blockId:n})}),document.getElementById("root")),G||W.showMainUI()}(e,n,t)};G?Q("foo\n`yarn install`\n|title1|title2|\n|--|--|\n|content1|content2|\n\n**bold**\nother\n\n|table2|table2|\n|--|--|\n|contentB|contentB|\n\n|table2|table2|\n|--|--|\n|contentB|contentB|\n|contentB|contentB|\n|contentB|contentB|\n|contentB|contentB|",111):W.ready().then((function(){W.provideStyle("\n      iframe#logseq-markdown-table.lsp-iframe-sandbox {\n        z-index: 10;\n      }\n    "),console.log("[faiz:] === markdown-table-editor-plugin loaded"),J.registerBlockContextMenuItem("markdown-table-editor",(function(e){console.log("[faiz:] === woz-markdown-table-editor",e),J.getBlock(e.uuid).then((function(t){console.log("[faiz:] === block",t);var n=t.format,r=t.content;if("markdown"!==n)return $.showMsg("woz-markdown-table-editor only support markdown","warning");Q(r,e.uuid)}))})),W.on("ui:visible:changed",(function(e){e.visible||i.a.unmountComponentAtNode(document.getElementById("root"))}))}))}},[[261,1,2]]]);
//# sourceMappingURL=main.5f6f4df2.chunk.js.map